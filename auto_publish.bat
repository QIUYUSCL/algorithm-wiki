@echo off
chcp 65001
set PYTHONIOENCODING=utf-8

:: ============ 1. é…ç½®åŒºåŸŸ (è¯·æ ¸å¯¹è¿™é‡Œ) ============
:: ä½ çš„äº‘æœåŠ¡å™¨å…¬ç½‘ IP
set SERVER_IP=47.93.24.69

:: å®å¡”é¢æ¿é‡Œçš„ç½‘ç«™æ ¹ç›®å½• (æ ¹æ®ä½ ä¹‹å‰çš„æˆªå›¾å¡«å†™çš„)
set SERVER_DIR=/www/wwwroot/blog.testscl.xyz/dist
:: ================================================

:: å¼ºåˆ¶è·³è½¬åˆ°é¡¹ç›®æ‰€åœ¨çš„æ–‡ä»¶å¤¹
cd /d "E:\vue\algorithm-wiki"

echo ==========================================
echo      ğŸš€ å…¨æ¸ é“å‘å¸ƒ (GitHub + äº‘æœåŠ¡å™¨)
echo ==========================================

:: --- ç¬¬ä¸€æ­¥ï¼šåŒæ­¥ç¬”è®° ---
echo [1/4] æ­£åœ¨ä» Obsidian åŒæ­¥ç¬”è®°...
python sync_notes.py
if %errorlevel% neq 0 (
    echo âŒ åŒæ­¥å¤±è´¥ï¼Œè„šæœ¬ç»ˆæ­¢ã€‚
    pause
    exit /b
)

:: --- ç¬¬äºŒæ­¥ï¼šæœ¬åœ°æ„å»º (ç”Ÿæˆç½‘é¡µæ–‡ä»¶) ---
echo [2/4] æ­£åœ¨æœ¬åœ°æ„å»ºé™æ€ç½‘ç«™ (npm run docs:build)...
:: ä½¿ç”¨ call æ˜¯ä¸ºäº†é˜²æ­¢ npm æ‰§è¡Œå®Œç›´æ¥å…³é—­çª—å£
call npm run docs:build
if %errorlevel% neq 0 (
    echo âŒ æ„å»ºå¤±è´¥ï¼è¯·æ£€æŸ¥æ˜¯å¦æœ‰ Markdown è¯­æ³•é”™è¯¯æˆ–æ­»é“¾ã€‚
    pause
    exit /b
)

:: --- ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ ---
echo [3/4] æ­£åœ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ (%SERVER_IP%)...
:: scp -r (é€’å½’å¤åˆ¶) distæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹ -> æœåŠ¡å™¨ç›®å½•
scp -r .vitepress/dist/* root@%SERVER_IP%:%SERVER_DIR%

if %errorlevel% equ 0 (
    echo âœ… æœåŠ¡å™¨éƒ¨ç½²æˆåŠŸï¼ç½‘ç«™å·²æ›´æ–°ã€‚
) else (
    echo âŒ ä¸Šä¼ å¤±è´¥ï¼
    echo è¯·æ£€æŸ¥ï¼š1. SSH æ˜¯å¦å…å¯†ç™»å½•  2. æœåŠ¡å™¨ç›®å½•æ˜¯å¦å­˜åœ¨
)

:: --- ç¬¬å››æ­¥ï¼šæ¨é€åˆ° GitHub (ä»…åšæºç å¤‡ä»½) ---
echo [4/4] æ­£åœ¨å¤‡ä»½æºç åˆ° GitHub...
git add .
set timestamp=%date% %time%
git commit -m "Auto deploy: %timestamp%"
git push

echo.
echo ğŸ‰ğŸ‰ğŸ‰ å…¨éƒ¨æµç¨‹ç»“æŸï¼
pause