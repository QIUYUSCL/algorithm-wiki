# ğŸ§© å½’å¹¶æ’åº (Merge Sort)

> **å½’æ¡£**: #Algorithm #Sorting #Advanced
> 
> **æ ¸å¿ƒå¿ƒæ³•**: "å…ˆæ‹†ååˆ" â€”â€” åƒæ‹‰é“¾ä¸€æ ·ï¼ŒæŠŠä¸¤ä¸ªæœ‰åºçš„é“¾æ¡åˆå¹¶æˆä¸€æ¡ã€‚

## ğŸ§  æ ¸å¿ƒæ€æƒ³ (ååºéå†)
å½’å¹¶çš„æœ¬è´¨æ˜¯äºŒå‰æ ‘çš„**ååºéå†**ã€‚
1.  **åˆ† (Divide)**ï¼šä¸€åˆ€ä¸¤æ–­ï¼Œé€’å½’åˆ‡åˆ†ç›´åˆ°å­æ•°ç»„åªå‰© 1 ä¸ªå…ƒç´ ï¼ˆå¤©ç„¶æœ‰åºï¼‰ã€‚
2.  **åˆ (Merge)**ï¼šå°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶æˆä¸€ä¸ªå¤§çš„æœ‰åºæ•°ç»„ã€‚

## ğŸ¨ å›¾è§£æ¼”ç¤º

<MergeSortAnimation />

```mermaid
graph BT
    subgraph Merge Phase
    A[1] & B[5] -->|è°å°æ‹¿è°| C[1, 5]
    D[2] & E[8] -->|è°å°æ‹¿è°| F[2, 8]
    C & F -->|åŒæŒ‡é’ˆåˆå¹¶| G[1, 2, 5, 8]
    end
    subgraph Divide Phase
    Source[1, 5, 2, 8] -.-> A & B & D & E
    end
    style G fill:#9f6,stroke:#333
````

## ğŸ’» ä»£ç å®ç° (C++)


```cpp
// å¯¹åº”åŠ¨ç”»ä¸­çš„ "é€’å½’æ¨¡å¼"
// æ ¸å¿ƒæ€è·¯ï¼šåˆ†è€Œæ²»ä¹‹ï¼Œå…ˆé€’å½’æ‹†åˆ†åˆ°æœ€å°ï¼Œå†å›æº¯åˆå¹¶
class Solution {
public:
    vector<int> sortArray(vector<int>& nums) {
        if (nums.empty()) return nums;
        vector<int> temp(nums.size()); // æå‰å¼€è¾Ÿç©ºé—´ï¼Œé¿å…é€’å½’ä¸­é¢‘ç¹ç”³è¯·
        mergeSort(nums, 0, nums.size() - 1, temp);
        return nums;
    }

    // é€’å½’ä¸»å‡½æ•°
    void mergeSort(vector<int>& nums, int left, int right, vector<int>& temp) {
        if (left >= right) return;

        int mid = left + (right - left) / 2;
        mergeSort(nums, left, mid, temp);      // æ’å·¦è¾¹
        mergeSort(nums, mid + 1, right, temp); // æ’å³è¾¹

        merge(nums, left, mid, right, temp);   // åˆå¹¶
    }

    // åˆå¹¶ä¸¤ä¸ªæœ‰åºåŒºé—´
    void merge(vector<int>& nums, int left, int mid, int right, vector<int>& temp) {
        int i = left;
        int j = mid + 1;
        int t = 0; // temp çš„ä¸´æ—¶æŒ‡é’ˆ

        // åŒæŒ‡é’ˆæ¯”å¤§å°
        while (i <= mid && j <= right) {
            if (nums[i] <= nums[j]) {
                temp[t++] = nums[i++];
            } else {
                temp[t++] = nums[j++];
            }
        }

        // å¤„ç†å‰©ä½™å…ƒç´ 
        while (i <= mid) temp[t++] = nums[i++];
        while (j <= right) temp[t++] = nums[j++];

        // æŠ„å›åŸæ•°ç»„ (æ³¨æ„è¿™é‡Œè¦ä» temp æŠ„å› nums)
        t = 0;
        while (left <= right) {
            nums[left++] = temp[t++];
        }
    }
};
```


```cpp
// å¯¹åº”åŠ¨ç”»ä¸­çš„ "è¿­ä»£æ¨¡å¼"
// æ ¸å¿ƒæ€è·¯ï¼šä» width=1 å¼€å§‹ï¼Œä¸¤ä¸¤åˆå¹¶ï¼Œå†å››å››åˆå¹¶... ç›´åˆ° width >= n
class Solution {
public:
    vector<int> sortArray(vector<int>& nums) {
        int n = nums.size();
        vector<int> tmp(n);
        
        // width ä»£è¡¨å­æ•°ç»„é•¿åº¦ï¼š1 -> 2 -> 4 -> 8 ...
        for (int width = 1; width < n; width *= 2) {
            // éå†æ•°ç»„ï¼Œæ¯æ¬¡å¤„ç†ä¸¤ä¸ª width é•¿åº¦çš„å—
            for (int i = 0; i < n; i += 2 * width) {
                int left = i;
                int mid = min(i + width - 1, n - 1);
                int right = min(i + 2 * width - 1, n - 1);
                
                // åªæœ‰å½“å­˜åœ¨å³åŠéƒ¨åˆ†æ—¶æ‰éœ€è¦åˆå¹¶
                if (mid < right) {
                    merge(nums, tmp, left, mid, right);
                }
            }
        }
        return nums;
    }

    // åˆå¹¶å‡½æ•° (ä¸é€’å½’ç‰ˆé€»è¾‘ä¸€è‡´)
    void merge(vector<int>& nums, vector<int>& tmp, int left, int mid, int right) {
        int i = left, j = mid + 1, k = left;
        while (i <= mid && j <= right) {
            if (nums[i] <= nums[j]) tmp[k++] = nums[i++];
            else tmp[k++] = nums[j++];
        }
        while (i <= mid) tmp[k++] = nums[i++];
        while (j <= right) tmp[k++] = nums[j++];
        
        for (int p = left; p <= right; p++) nums[p] = tmp[p];
    }
};
```


## ğŸ“Š å¤æ‚åº¦åˆ†æ

|**ç»´åº¦**|**æ•°å€¼**|**è¯´æ˜**|
|---|---|---|
|**æ—¶é—´ (å¹³å‡)**|$O(N \log N)$|é›·æ‰“ä¸åŠ¨ï¼Œéå¸¸ç¨³|
|**æ—¶é—´ (æœ€å·®)**|$O(N \log N)$|ä¸å—æ•°æ®åˆ†å¸ƒå½±å“|
|**ç©ºé—´**|**$O(N)$**|éœ€è¦ä¸€ä¸ªé¢å¤–çš„ temp æ•°ç»„ (è¿™æ˜¯ç¼ºç‚¹)|
|**ç¨³å®šæ€§**|âœ… **ç¨³å®š**|åˆå¹¶æ—¶å·¦è¾¹å…ˆå…¥ï¼Œä¿è¯äº†ç¨³å®šæ€§|

## ğŸ’¡ é€‚ç”¨åœºæ™¯

- **é“¾è¡¨æ’åº**ï¼šå”¯ä¸€çš„ç¥ï¼ä¸éœ€è¦é¢å¤–ç©ºé—´ï¼Œåªæ”¹æŒ‡é’ˆã€‚
    
- **å¤§æ•°æ®å¤–éƒ¨æ’åº**ï¼šå†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œåˆ‡åˆ†æ–‡ä»¶æ’å¥½å† Mergeã€‚
    
- **éœ€è¦ç¨³å®šæ’åºæ—¶**ï¼šæ¯”å¦‚æŒ‰â€œåˆ†æ•°â€æ’åºï¼Œåˆ†æ•°ä¸€æ ·è¦ä¿æŒâ€œå­¦å·â€é¡ºåºã€‚